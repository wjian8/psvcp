#!/usr/bin/python
# -*- coding: UTF-8 -*- 
# Usage: python3 $0 i.gff.in_pv i.gff_gene_absolutly.in_pv
# fix on 2024.9.13    IR64.gff  in the gfffile column 9,  some line have gene name and ":", and some line have no ";".
'''
Chr1	IR64	gene	13294561	13294710	.	-	.	ID=OsIR64G0100518200.01;Name=OsIR64G0100518200.01;Description=protein_coding_partial	Chr1	15895888	15902408	Insertion	ATGTTGGAAATATAGTCATTATTCGGCATATTTTAATCCAAGAAATTGAAACAATGATCATGGCATAAGTAGTGTAGGGTGATCTTAACATAACCAATAGCAGACTATGTGCATCATGAATGTCAGAAACAGGAACATAGCGCACACAGTATAGCGCTAACAATGGGAACAGGAGTAGTGCTAACAGCAGTAGTAGGAGGAGAAGATTATACCCCGAGAATGGCCCTCCGCTGGATGGTGAGGCAGAATTGCCTCCGTTGTTGTAGTCGTTCACGCCCCCTCCTGTCGGCGGCGGCGCACCACCTCCGCTAGCTCCTGTCGGCGGCGGCGCACCTCCACCAGTAGCGGCGGCGACAACTCCGGACATGGCGATGAGCAGTCGTGCAGGAGGCACTCCCCAAAAACCTGATCACCCGCCTACCCGGTGCAGATCTCAGGCGAAGGTGTGGTTTCGGAGGCACTGCTTCTTCCAATCTCTCGTGCGCGCAAGAGATCAGAAGCGGGGAAGCGAAAGCAACTCAGGCGCGGAGCAGGAGAAACTAACACCGGGAAGCAAGCGAAGAAGTCGGATCAGACTCGCGGCCTCCTTATCTAGAGAAAGAACGTGGACGCGCTGTTGCGGAGGGAATCGTGGGAACGTGGGTTAGTGGCTGCAAAAGGATAGTGACGTGACGTGACGTGACGCACGCACGCACGCCGCCAGCGGAGCAGGAGAAACTAACACCGGGAAGCAAGCGAAGAAGTCGGATCAGACTCGCGGCCTCCTTATCTAGAGAAAGAACGTGGACGCGCTGTTGCGGAGGGAATCGTGGGAACGTGGGTTGGAAAGAACGTGGACGCGCTGTTGCGGAGGGAATCGTGGGAACGTGGGTTAGTGGCTGCAAAAGGATAGCGACGTGACGTGACGCACGCACGCCGCCAGCCAGGCCAGGCCACGCCTCGCCTCGCCTCGCCTCGCCCTCGCCCACGCCCACGCCCACGCCCACGGCCCGGCCCGGCGCGCGCGCGCGCGTGTGGCATTCTGACCCCCACCTCAACTGGTCAACAGGGAGCCTCTAATAACTCCCTATTTAGGTTGAGATATTTCTCGCTTAAATCCTGAGGTGGTATTATTATCCTTAACATTTATTATGGGCCTTTGAGATTTAATAGAGTAAATTGGGCCTAGCCCAATTATTCTAACAATCCCCACCAAATTTCAAGGTTCATAAGAAATGTTCTCAGTGTTGTGCCTGTTTGATATACCAGGGTTTTGGTGGAGACTGTTAAGTTGAACTTCCACCTAGGAAATGAGCTACATCAGACCACAACTTAACAATGGACTATGCCTTGAATTGTAAGTTTTGTGTGATCAGGTTTCACTCAGAACCTTGACTGGTACTAGGCTGCCGTTCGCATCCCCTCTGTTTGGAGCATATAAGTCAAACTCCAGGCCTTTCATGAGTATCTAGAGATTTCCCAAATCTCATAGACTGTGACTAGCAGTCGAACTCATATAGGTGTGTTCCTTCTGAGATGTTCTGCAGGTCAACATCTCTGCTTGGAAAAGCCACTCGGATCACATTAAGACATAAGCCATCCTACCATGCAGGAAAGAAGAGAAGCACATCATGGAAATGAGCCCTTTTCAAGGGTCTCTTCTCTCAGTCACACAATAGTTTGTTTCACCATCCAAATTCACGGGATCTCCAATCACAATGGACAGGTTTCCACTATTATGCAACCTTAGGTGGGTATCAAGCCCATTTCCCTCGATGCACTGTCTATCACATTACGTGGTAGCCCCTTGGTAAACTGATCTGCCAGATTTCTAGCCGTTTGGACATAGTCCAATGCTATCACTCCGGAGTTTTTCTGCTTTCTGACAGATTTCAGTCTTCTCTTGATGTGTCTAGATGACTTCATGTTGTCCTTTGAACTGTTCACTTTAATAATCACTGTTTGATTATCGCAGTTCATTAGGATAGCTGGCACTGGTTTTTCAACCATCGGCAAATCCATCAGGAGTTCACGAAGCCACTCGGCCTCAACTGTCGCAGTATCTAGTGCTGTAAGTTCTGCTTCCATTGTTGACCTCGTTAAGATGGTCTGCTTGCAAGACTTCCAGGAAACAGCGCCACCTCCAAGTGTGAACACATATCCACTTGTGGCTTTTATCTCATCAGCATCAGATATCCAGTTTGAGTCACTATACCCTTCTAGTACTTTTGGATACCCGGTATAGTGAATTCCATAGCTCATAGTGCCCTTTAGATAGCGCATTACTCTTTCCAGAGCCTGCCAGTGATCATCTCCCGGATTTGAGACAAACCGGCTCAGCTTGCTTACAGCAAATGAGATGTCAGGCCTAGTTGCGCTAGCCAAGTACATCAATGAGCCAATGATTTGAGAGTATCTCAGTTGATCCCTTGCTATTCTTCGGTTTTTCCTTAATAGCACGCTGGGATCATAAGGAGTAGGAGCTGGCTTGCAGTCACCATATCCAAAGCGACTCAAAACCTTGTCCACATAGTGGGATTGCACAAGTGTAATCCCACCCTCATCTCCTCTTTGTAGTTTGATGTTAAGAATAACATCAGCCTCTCCCAAATCCTTCATTTCAAAATTCTTAGACAGATAGTCTTTGACCTCCTCAATCACATTAAGGCTGGTCCCAAAGATCAGTATGTCATCGACATACAAGCACAAGATCACCCCTTCTCCCCCACCATAGCGATAGTATACACATTTGTCAGCTTCGTTCACAACAAAGCCTGCAGATGTAAGCGTGATGTCAAACTTCTCATGCCATTGCTTAGGTGCTTGCTTGAGGCCATACAAGGATTTCAATAGTTTACACACCATTCCCTCCTGACCTTCTAGTACATACCCGTCTGGTTGATCCATATAGATCTCCTCCTCCAGCTCTCCGTTTAGGAAAGCTGTCTTAACGTCCATCTGATGGACGAGAAGACCATGAGAGGCTGCCAGAGCAAGTAGTACTCGAATCGTAGTCAAGCGAGCAACTGGTGAATATGTGTCGAAGAAATCCTCGCCTTCCTTTTGGGTATAACCCTTGGCCACAAGCCTTGCCTTGTACTTTTCAATTGTACCATCAGGCCTAAGCTTTTTCTTGAAAACCCATTTGCATCCTACGGGCCTGCACCCATATGGACGCTCAATGACTTCCCAAGTACCATTAGACATAATCGAGTCCATTTCACTGCGTACTGCTTCCTTCCAGTAGTCAGTGTCAGGAGATGAATATGCCTCTTCTATGGTTCTTGGGGTGTCATCCACGAGGTATACAATGTAGTCATCTCCAAAGGATTTTGCAACCCTTTGTCTCTTACTCTTGCGAGTATCTACAATGTTGTCCTCCTCAGGATTTTCCTCAGGCGTTTCATCATTGTGTTCTATCGGTGCAAAGTGCTCATGGGGCATGACAGTTTCTTTACTAGAAGTGATAGGTGTATATTTCATAGGAAATTCACTCTCAAAGAATGTAGCATCTCTGGACTCAAAAATTATACCAGCATGCATGTCGGGTACTCCAGAGTTTACTATTAAGAATCTATAGCCCACACTGTGGATAGCATAACCAAGAAACACACAATCAACAGTTTTTGGTCCAAGTTTCCGCTTTTTGACTATAGGTACATTTACCTTGGCCAAACAGCCCCATGTTCGTAGGTATGAGAGATTTAATTTCTTCCTTTCCCATTCCTCGAATGGTGTTACTTCCTTATGCTTCATTGGAATTTTATTCAGGACATGACACGCAGTCAAAACTGCCTCACCCCACCATTCCTTCGAAAGCCCCGCAGTGTCTAACATGGCATTCACCATCTCAGTTAGAGTACGGTTCTTTCTTTCGGCCACCCCATTTGATTGGGGTGAATAAGGAGGCGTCATCTCATGAATAATTCCAAACTCTTCGCAAAAGGATGTAAACTCATTGGAAAAATACTCCCCACCTCTATCAGACCTCAACCGTTTGATTTTCCTTTCAAGTTGGTTTTCTACCTCAGCTTTATAGATTTTAAAGTAATGCAATGCCTCATCCTTTGTTTTCAATAGATACACATAGCAAAATCTAGTGCAATCATCTATCAGTGTCATGAAATATTTCTTTCCTCCTTTAGTCAACACGCCGTTCATTTCGCACAAATCGGAATGAACAAGTTCTAGAGGTGCCAAATTCCTCGCCTCAGATGCCTTGTGAGGCTTGCGAGGTTGTTTCGATTGAACACAAGTATGGCACTTGGAACCTTTGACCAAAGTGAATTTTGGAATTAAACTCATGTTAGCTAAGCGCGTCATACAGCCGAAATTCACATGACAGAGTCGCGAATGCCACACATTAGACTCATCATTCTCGCTAATATGGTTCACAACATTATGATTATTACACATGTCATTCAAAGAAAAGCGGAACAAGCCTCCGCTGTCATAACCTTTTCCAACAAAAGTCCCATATTTAGATACGACACATTTATTGGACTCAAACACAAGTCTAAAACCTTCTCTACACAATAGAGAGCCGCTAACTAGATTCTTCTTTATTGAAGGGACATGCTGCACGTTCTTCAGCTGCACGGTCTTTCCCGAAGTAAACTTCAGATCGACCGTACCAACACCATGAACAGCCGCAAGCGACCCGTTTCCCATCAACAAGGAGGAACCTCTCCCGACCTGATAAGAAGAAAACAGAGAAATGTCAGCACATACATGAATATTAGCACCAGTATCCACCCACCAATCAGGTGAATGAAAAACAGAGAGAACTGTAGGTAATATTTTACCGTACCCCGATGTTTCTCCGCCCTCGCTAATGATCATGTTGGCAGACTTCCTGTCTTTGCGCTCAGGACAGTCCTTGGCCCAATGCCCAGACTTGCCACACACAAAGCAGTCTCCTTTTGCCTTTCCCTTGCCTTTCTTCTTAAAATTGGTTGCAGCCTTGGGTTTGACATCAGGCTTGACTTTCTTGTTGTTGTGGGATGCATGAGGGTTCTTCTTCTGTACCATATTGGCACTAGAACCTCCCTCAACCTTTTTGCCCCGCACGTCCTTTGCCCTCGCCTTCTCCTCAACACCCAAAGAGCCAATGAGATCAGGAACACTGAACTCTTGTCTCTTGTGCTTTAGAGAAGTGGCAAAGTCCGACCAAGAAGGTGGCAGTTTGGCAATAATGCCACCCGCCACAAACTTGTCTGGCAACTCACAGTTGTTGTTCTCAAGTTCCTTAGCCAGCATCTGAATCTCATGAGCTTGTTCTACTACAGAACGGTCATCGACCATCTTGTAGTCATAGAACTGCTCCATGACATACAGCTCACTGCCAGCGTCAGAAACTCCGAACTTAGCCTCAAGTGCATCCCACATGTCCTTCCCAGAAGGCATGTGCATGTACACGTCCACTATGTTGTCAGCGAGTACACTGATCAATGCTCCACGGAACAGGCAATCCGAAGCCTCGAACTTAGCCTCTTCCTCAGGAGAGAGAGGTGGTTCACTTCGTTTGCCCCGTGAAACATAGAAGCACTGCATCGCTGTCAACCATAATAGTGCACGTGCTTTCCATCTCTTATAGTTTGAACCATCAAAAGCATGTGGTTTCAGTGCAGCAGCAAAGCCAACTACCGAAAATGACCTATCAGGTTTTTGGATTGTTGGAAATATAGTCATTATTCGGCATATTTTAATCCAAGAAATTGAAACAATGATCATGGCATAAGTAGTGTAGGGTGATCTTAACATAACCAATAGCAGACTATGTGCATCATGAATGTCAGAAACAGGAACATAGCGCACACAGTATAGCGCTAACAATGGGAACAGGAGTAGTGCTAACAGCAGTAGTAGGAGGAGAAGATTATACCCCGAGAATGGCCCTCCGCTGGATGGTGAGGCAGAATTGCCTCCGTTGTTGTAGTCGTTCACGCCCCCTCCTGTCGGCGGCGGCGCACCTCCACCAGTAGCGGCGGCGACAACTCCGGACATGGCGATGAGCAGTCGTGCAGGAGGCACTCCCCAAAAACCTGATCACCCGCCTACCCGGTGCAGATCTCAGGCGAAGGTGTGGTTTCGGAGGCACTGCTTCTTCCAATCTCTCGTGCGCGCAAGAGATCAGAAGCGGGGAAGCGAAAGCAACTCAGGCGCGGAGCAGGAGAAACTAACACCGGGAAGCAAGCGAAGAAGTCGGATCAGACTCGCGGCCTCCTTATCTAGAGAAAGAACGTGGACGCGCTGTTGCGGAGGGAATCGTGGGAACGTGGGTTAGTGGCTGCAAAAGGATAGCGACGTGACGCACGCCGCGCCCTCGCCCTCGCCCACGGCCACGGCCCGGCGCGCGCGCGCGCGCGCGTGTGGCATTCTGACCCCCACCTCAACTGGTCAACAGGGAGCCTCTAATAACTCCCTATTTAGGTTGAGATATTTCTCGCTTAAATCCTGAGGTGGTATTATTATCCTTAACATTTATTATGGGCCTTTGAGATTTAATAGAGTAAATTGGGCCTAGCCCAATTATTCTAACA	IR64	Chr1	13290036
Chr11	AUGUSTUS	gene	25109152	25112826	1	+	.	ID=OsIR64G1180000392.01	Chr11	30429966	30441253	Insertion
'''


import pandas as pd
import re, sys
df = pd.read_csv(sys.argv[1],sep='\t',header=None)
genes_info = [gene_info for gene_info in list(df[df.iloc[:,2]=='gene'].iloc[:,8])]
genes = []
if genes_info:  # if the pav include gene
    for gene_info in genes_info:
        gene_name = re.findall('ID=(.+?);', gene_info)
        if gene_name:
            genes.append(gene_name[0])
        else:
            gene_name = re.findall('ID=(.+)',gene_info)
            if gene_name:
                genes.append(gene_name[0])

genes_set = set(genes)      
gene_in_pv = [any([gene in gff for gene in genes_set]) for gff in df.iloc[:, 8]]  # each line which contain mRNA, exon or cds have the geneID info.
df[gene_in_pv].to_csv(sys.argv[2], sep='\t', index=False, header=False, float_format=None)
